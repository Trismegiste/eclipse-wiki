{# Search into InvokeAI images for appending to vertex #}
{% extends "invokeai/search.html.twig" %}

{% block title %}Append picture{% endblock %}
{% block header_title %}{{ vertex.title }}{% endblock %}

{% block picture %}
    <a x-bind="linkParameter(picture)">
        <img x-bind:src="picture.thumb" class="pure-img"/>
    </a>
    <div class="legend" x-text="picture.width"></div>
{% endblock %}


{% block javascripts %}
    {{ parent() }}
    <script type="module">
        import stableDiffusion from 'sd-gallery-search';

        Alpine.data('stableDiffusion', (source, url) => {
            let obj = stableDiffusion(source, url)
            obj.appendUrl = '{{ path('app_invokeaipicture_vertexappend', {pk: vertex.pk}) }}'

            obj.linkParameter = function (picture) {
                const param = new URLSearchParams({
                    storage: this.source,
                    pic: picture.name,
                    query: this.query
                })
                const href = this.appendUrl + '?' + param
                return {
                    ['href']: href,
                    ['title']: picture.prompt
                }
            }

            return obj
        })
    </script>
{% endblock %}