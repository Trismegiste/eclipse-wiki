{# Search into InvokeAI images for appending to vertex #}
{% extends "invokeai/search.html.twig" %}

{% block title %}Append picture{% endblock %}
{% block header_title %}{{ vertex.title }}{% endblock %}

{% block picture %}
    <a x-bind:href="makeLink(picture.name)" x-bind:title="picture.prompt">
        <img x-bind:src="picture.thumb" class="pure-img"/>
    </a>
    <div class="legend" x-text="picture.width"></div>
{% endblock %}


{% block javascripts %}
    {{ parent() }}
    <script type="module">
        import stableDiffusion from 'sd-gallery-search';

        Alpine.data('stableDiffusion', (source, url) => {
            let obj = stableDiffusion(source, url)
            obj.appendUrl = '{{ path('app_invokeaipicture_vertexappend', {pk: vertex.pk}) }}'
            obj.makeLink = function (pictureName) {
                const param = new URLSearchParams({
                    storage: this.source,
                    pic: pictureName,
                    query: this.query
                })

                return this.appendUrl + '?' + param
            }

            return obj
        })
    </script>
{% endblock %}