{# fragment to initialize a textarea with textcomplete JS #}
<script>
    var Textarea = Textcomplete.editors.Textarea
    var editor = new Textarea(document.getElementById('{{ element_id }}'));
    var textcomplete = new Textcomplete(editor);
    textcomplete.register([{
            // Link strategy for image
            match: /(.*)\[\[file\:([^\]]+)$/,
            search: function (term, callback) {
                fetch('{{ path('app_picture_search') }}' + '?q=' + term)
                        .then((response) => {
                            return response.json();
                        })
                        .then((data) => {
                            callback(data);
                        });
            },
            replace: function (value) {
                return '$1[[file:' + value + ']] ';
            },
            template: function (key, value) {
                return '<img src="/upload/' + key + '"/>'
            }
        },
        {
            // Link strategy for Vertex
            match: /(.*)\[\[([^\]]+)$/,
            search: function (term, callback) {
                fetch('{{ path('app_vertexcrud_search') }}' + '?q=' + term)
                        .then((response) => {
                            return response.json();
                        })
                        .then((data) => {
                            callback(data);
                        });
            },
            replace: function (value) {
                return '$1[[' + value + ']] ';
            }
        }]);
</script>