{% extends "base.html.twig" %}

{% block content %}
    <div x-data="autocomplete">
        <textarea x-model="content" x-on:keyup="editKeyUp" x-on:click="open=false" x-ref="editor" style="width: 600px; height: 200px;">
        </textarea>
        <template x-if="open">
            <select class="autocomplete-combobox" x-bind:style="caretPos" size="10"
                    x-model="selected"
                    x-on:click="choose"
                    x-on:blur="open=false"
                    x-on:keyup="comboKeyUp">
                <template x-for="item in result" :key="item['value']">
                    <option x-bind="item"></option>
                </template>
            </select>
        </template>
    </div>
{% endblock %}

{% block javascripts %}
    <script type="module">
        import wikitextCfg from 'wikitext';
        wikitextCfg.strategy = [
            {
                pattern: /\[\[file:([^\]]+)$/,
                url: '{{ path('app_picture_search') }}?q=',
                boundAttr: (entry) => ({
                        ['class']: 'img-option',
                        ['style']: `background-image:url(\\"/picture/get/${entry}\\")`
                    }),
                replace: (found) => {
                    return `[[file:${found}]]`
                }
            },
            {
                pattern: /\[\[([^\]]+)$/,
                url: '{{ path('app_vertexcrud_search') }}?q=',
                boundAttr: (entry) => ({
                        ['x-text'] () {
                            return entry
                        }
                    }),
                replace: (found) => {
                    return `[[${found}]]`
                }
            }
        ]
        Alpine.data('autocomplete', () => (wikitextCfg))
        Alpine.start()
    </script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .autocomplete-combobox {
            position: absolute;
            background-color: #eee;
        }
        .autocomplete-combobox .img-option {
            background-repeat: no-repeat;
            height: 5em;
            background-size: auto 5em;
            width: 10em;
        }
    </style>
{% endblock %}