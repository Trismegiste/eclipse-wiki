{% extends "vertex/show.html.twig" %}

{% block info %}
    {% if vertex.youtubeUrl is not empty %}
        <iframe width="220" height="150" src="https://www.youtube.com/embed/{{ vertex.youtubeUrl }}"
                title="{{ vertex.title }}" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
        </iframe>
    {% endif %}
{% endblock %}

{% block header_title %}
    <nav style="float: right">
        {{ include('place/actions.html.twig') }}
    </nav>
    {{ vertex.title }}
{% endblock %}

{% block content %}
    <div class="pure-g">
        <div class="pure-u-3-4">
            {{ parent() }}
            {% if vertex.npcTemplate is not empty %}
                <h2>PNJ</h2>
                La majorité des PNJ sont <a href="{{ path('app_placecrud_npcshow', {title: vertex.npcTemplate}) }}">{{ vertex.npcTemplate }}</a>
            {% endif %}
        </div>
        <aside class="pure-u-1-4">
            <div class="conditions"><i class="icon-gravity"></i>{{ vertex.gravity }}</div>
            <div class="conditions"><i class="icon-pressure"></i>{{ vertex.pressure }}</div>
            <div class="conditions"><i class="icon-temperature"></i>{{ vertex.temperature }}</div>
            <div class="pure-g">
                <div class="pure-u-1">
                    <a href="{{ path('app_placecrud_battlemap', {pk: vertex.pk}) }}" target="_blank">
                        <div id="battlemap"></div>
                    </a>
                </div>
                <div class="pure-u-1 conditions">
                    <a href="{{ path('app_mapcrud_list') }}" class="pure-button">Générer une map</a>
                </div>
            </div>
        </aside>
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .conditions {
            font-size: 140%;
            text-align: center;
            margin-top: 1em;
            margin-bottom: 2em;
        }
        .conditions i {
            display: block;
            font-size: 170%;
            margin-bottom: 0.3em;
        }
        #battlemap svg g.fog-of-war {
            opacity: 0;
        }
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% if vertex.battleMap is not empty %}
        <script>
            fetch('{{ path('get_picture', {title: vertex.battleMap}) }}', {
                redirect: 'manual'
            }).then(function (response) {
                if (!response.ok) {
                    return Promise.reject(response.statusText);
                }
                return response.text()
            }).then(function (svg) {
                let battlemap = document.getElementById('battlemap')
                battlemap.innerHTML = svg
                document.querySelector('#battlemap svg').attributes.removeNamedItem('height')
                document.querySelector('#battlemap svg').attributes.removeNamedItem('width')
            }).catch((error) => {
                console.error(error);
            })
        </script>
    {% endif %}
{% endblock %}