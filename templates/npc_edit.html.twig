{% extends "base.html.twig" %}

{% form_theme form _self %}

{% block _npc_stats_edges_widget %}
    <div class="pure-g">
        <template x-for="edge in edges">
            <div class="pure-u-1">
                <label x-text="edge.name"></label>
            </div>
        </template>
    </div>
{% endblock %}

{% block content %}
    {{ form(form, {attr: {'x-data': form.vars.data|json_encode()}}) }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="//unpkg.com/alpinejs" defer></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {

            // link checkbox to listing
            [...document.querySelectorAll('#npc_stats_skill_list input[type=checkbox]')].forEach(function (item) {

                // check the checkbox if the same skill in the listing
                if (document.querySelector('#npc_stats_skills input[type=hidden][value="' + item.value + '"]') !== null) {
                    item.checked = true
                }

                // Add event listener on checkbox
                item.addEventListener('change', function (ev) {

                    const key = ev.target.id.match(/.+_(\d+)$/)[1]
                    const skillName = ev.target.value

                    if (ev.target.checked) {
                        // Append skill
                        const collectionHolder = document.querySelector('#npc_stats_skills')

                        collectionHolder.innerHTML += collectionHolder
                                .dataset
                                .prototype
                                .replace(/__name__/g, Math.floor(100 + 1000000 * Math.random()))
                                .replace(/__undefined__/g, skillName)
                    } else {
                        // Delete skill
                        document.querySelector('#npc_stats_skills input[type=hidden][value="' + skillName + '"]').parentNode.parentNode.remove()
                    }
                })
            })
        })
    </script>
{% endblock %}