{% extends "base.html.twig" %}
{% block content %}
    {{ form(form) }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            // link checkbox to listing
            [...document.querySelectorAll('#npc_stats_skill_list input[type=checkbox]')].forEach(function (item) {

                // check the checkbox if the same skill in the listing
                if (document.querySelector('#npc_stats_skills input[type=hidden][value="' + item.value + '"]') !== null) {
                    item.checked = true
                }

                // Add event listener on checkbox
                item.addEventListener('change', function (ev) {

                    const key = ev.target.id.match(/.+_(\d+)$/)[1]
                    const skillName = ev.target.value

                    if (ev.target.checked) {
                        // Append skill
                        const collectionHolder = document.querySelector('#npc_stats_skills')

                        collectionHolder.innerHTML += collectionHolder
                                .dataset
                                .prototype
                                .replace(/__name__/g, Math.floor(100 + 1000000 * Math.random()))
                                .replace(/__undefined__/g, skillName)
                    } else {
                        // Delete skill
                        document.querySelector('#npc_stats_skills input[type=hidden][value="' + skillName + '"]').parentNode.parentNode.remove()
                    }
                })
            })

            // adding edge on change :
            document.querySelector('#npc_stats_edge_list').addEventListener('change', function (ev) {
                const collectionHolder = document.querySelector('#npc_stats_edges')
                const edgeName = ev.target.value

                collectionHolder.innerHTML += collectionHolder
                        .dataset
                        .prototype
                        .replace(/__name__/g, Math.floor(100 + 1000000 * Math.random()))
                        .replace(/__undefined__/g, edgeName)
            })
        })
    </script>
{% endblock %}